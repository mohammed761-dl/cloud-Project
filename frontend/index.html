<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>User Management System</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #f5f5f5;
      }
      .navbar {
        background: #0078d4;
        color: white;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .navbar h1 {
        margin: 0;
      }
      .status {
        margin-top: 0.5rem;
        font-size: 0.9rem;
      }
      .status.connected {
        color: #90ee90;
      }
      .status.error {
        color: #ffb6c6;
      }

      .container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .form-section {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }
      .form-section h2 {
        margin-bottom: 1.5rem;
        color: #0078d4;
      }

      .form-group {
        margin-bottom: 1rem;
      }
      label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #333;
      }
      input[type="text"],
      input[type="email"] {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
      }
      input[type="text"]:focus,
      input[type="email"]:focus {
        outline: none;
        border-color: #0078d4;
        box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }
      @media (max-width: 600px) {
        .form-row {
          grid-template-columns: 1fr;
        }
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      button {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
      }
      .btn-primary {
        background: #0078d4;
        color: white;
      }
      .btn-primary:hover {
        background: #005a9e;
      }
      .btn-danger {
        background: #e81123;
        color: white;
      }
      .btn-danger:hover {
        background: #c50f1f;
      }
      .btn-secondary {
        background: #6c757d;
        color: white;
      }
      .btn-secondary:hover {
        background: #5a6268;
      }

      .button-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .users-section {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .users-section h2 {
        margin-bottom: 1.5rem;
        color: #0078d4;
      }

      .user-list {
        list-style: none;
      }
      .user-item {
        background: #f9f9f9;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-radius: 6px;
        border-left: 4px solid #0078d4;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }
      .user-info {
        flex: 1;
        text-align: left;
      }
      .user-info h3 {
        color: #333;
        margin-bottom: 0.5rem;
      }
      .user-info p {
        color: #666;
        font-size: 0.9rem;
        margin: 0.25rem 0;
      }
      .user-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .empty-message {
        text-align: center;
        color: #666;
        padding: 2rem;
      }

      .alert {
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 4px;
      }
      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <div class="navbar">
      <h1>ðŸ‘¥ User Management System</h1>
      <div class="status" id="status">Checking Backend...</div>
    </div>

    <div class="container">
      <!-- Create User Form -->
      <div class="form-section">
        <h2>Add New User</h2>
        <div id="alert-container"></div>
        <form id="createUserForm">
          <div class="form-row">
            <div class="form-group">
              <label for="username">Username:</label>
              <input
                type="text"
                id="username"
                name="username"
                required
                placeholder="john_doe"
              />
            </div>
            <div class="form-group">
              <label for="email">Email:</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="john@example.com"
              />
            </div>
          </div>
          <div class="form-group checkbox-group">
            <input type="checkbox" id="is_active" name="is_active" checked />
            <label for="is_active" style="margin: 0">Active User</label>
          </div>
          <button type="submit" class="btn-primary">Create User</button>
        </form>
      </div>

      <!-- Users List -->
      <div class="users-section">
        <h2>Users List</h2>
        <ul class="user-list" id="usersList">
          <li class="empty-message">Loading users...</li>
        </ul>
      </div>
    </div>

    <script>
      const API_BASE = "http://74.242.218.195:30080";
      const statusElement = document.getElementById("status");
      const usersList = document.getElementById("usersList");
      const createUserForm = document.getElementById("createUserForm");
      const alertContainer = document.getElementById("alert-container");

      // Check Backend Connection
      async function checkBackend() {
        try {
          const res = await fetch(`${API_BASE}/users`);
          if (res.ok) {
            statusElement.innerText = "âœ“ Connected to Backend";
            statusElement.className = "status connected";
            return true;
          }
        } catch (err) {
          statusElement.innerText = "âœ— Backend Connection Failed";
          statusElement.className = "status error";
          return false;
        }
      }

      // Show Alert Message
      function showAlert(message, type = "success") {
        const alertDiv = document.createElement("div");
        alertDiv.className = `alert alert-${type}`;
        alertDiv.textContent = message;
        alertContainer.innerHTML = "";
        alertContainer.appendChild(alertDiv);
        setTimeout(() => alertDiv.remove(), 4000);
      }

      // Load and Display Users
      async function loadUsers() {
        try {
          const res = await fetch(`${API_BASE}/users`);
          const users = await res.json();

          usersList.innerHTML = "";
          if (users.length === 0) {
            usersList.innerHTML =
              '<li class="empty-message">No users yet. Create one to get started!</li>';
            return;
          }

          users.forEach((user) => {
            const li = document.createElement("li");
            li.className = "user-item";
            li.innerHTML = `
                        <div class="user-info">
                            <h3>${user.username}</h3>
                            <p>ðŸ“§ ${user.email}</p>
                            <p>Status: <strong>${user.is_active ? "âœ“ Active" : "âœ— Inactive"}</strong></p>
                            <p style="font-size: 0.8rem; color: #999;">ID: ${user.id}</p>
                        </div>
                        <div class="user-actions">
                            <button class="btn-secondary" onclick="editUser('${user.id}', '${user.username}', '${user.email}', ${user.is_active})">Edit</button>
                            <button class="btn-danger" onclick="deleteUser('${user.id}', '${user.username}')">Delete</button>
                        </div>
                    `;
            usersList.appendChild(li);
          });
        } catch (err) {
          usersList.innerHTML =
            '<li class="empty-message">Error loading users</li>';
        }
      }

      // Create User
      createUserForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const username = document.getElementById("username").value;
        const email = document.getElementById("email").value;
        const is_active = document.getElementById("is_active").checked;

        try {
          const res = await fetch(`${API_BASE}/users/`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, email, is_active }),
          });

          if (res.ok) {
            showAlert(`User "${username}" created successfully!`, "success");
            createUserForm.reset();
            document.getElementById("is_active").checked = true;
            loadUsers();
          } else {
            showAlert("Error creating user", "error");
          }
        } catch (err) {
          showAlert("Error: " + err.message, "error");
        }
      });

      // Delete User
      async function deleteUser(userId, username) {
        if (!confirm(`Delete user "${username}"?`)) return;

        try {
          const res = await fetch(`${API_BASE}/users/${userId}`, {
            method: "DELETE",
          });
          if (res.ok) {
            showAlert(`User "${username}" deleted successfully!`, "success");
            loadUsers();
          } else {
            showAlert("Error deleting user", "error");
          }
        } catch (err) {
          showAlert("Error: " + err.message, "error");
        }
      }

      // Edit User (placeholder - updates with form)
      function editUser(userId, username, email, is_active) {
        document.getElementById("username").value = username;
        document.getElementById("email").value = email;
        document.getElementById("is_active").checked = is_active;

        const originalSubmit = createUserForm.onsubmit;
        createUserForm.onsubmit = async (e) => {
          e.preventDefault();

          const updatedUsername = document.getElementById("username").value;
          const updatedEmail = document.getElementById("email").value;
          const updatedIsActive = document.getElementById("is_active").checked;

          try {
            const res = await fetch(`${API_BASE}/users/${userId}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                username: updatedUsername,
                email: updatedEmail,
                is_active: updatedIsActive,
              }),
            });

            if (res.ok) {
              showAlert(
                `User "${updatedUsername}" updated successfully!`,
                "success",
              );
              createUserForm.reset();
              createUserForm.onsubmit = originalSubmit;
              document.getElementById("is_active").checked = true;
              loadUsers();
            } else {
              showAlert("Error updating user", "error");
            }
          } catch (err) {
            showAlert("Error: " + err.message, "error");
          }
        };

        document.querySelector("form button").textContent = "Update User";
        window.scrollTo(0, 0);
      }

      // Initialize
      checkBackend();
      loadUsers();
      setInterval(loadUsers, 5000); // Refresh users every 5 seconds
    </script>
  </body>
</html>
